(function(i,n,l,c,o){"use strict";i.initializers.add("wusong8899-email-common",()=>{console.log("[wusong8899/flarum-email] Hello, forum and admin!")});class u extends c{constructor(){super(...arguments),this.loading=!1,this.exportCount=null,this.lastExportDate=null}oninit(t){super.oninit(t);const e=localStorage.getItem("wusong8899_email_last_export");if(e)try{const a=JSON.parse(e);this.exportCount=a.count,this.lastExportDate=a.date}catch{}}view(){return o("div",{className:"Form-group"},o("label",null,"导出有效邮箱"),o("p",{className:"helpText"},"点击导出所有通过 RFC + DNS 检查的唯一邮箱，每行一个。",this.exportCount!==null&&this.lastExportDate&&o("span",{className:"helpText-success"},o("br",null),"上次导出: ",this.exportCount," 个邮箱 (",this.formatDate(this.lastExportDate),")")),o(l,{className:"Button Button--primary",type:"button",onclick:()=>this.handleExport(),disabled:this.loading,loading:this.loading},this.loading?"导出中...":"导出邮箱"))}async handleExport(){if(console.log("Export button clicked"),!this.loading){this.loading=!0,o.redraw();try{console.log("Making request to:",n.forum.attribute("apiUrl")+"/admin-email-export");const t=await o.request({method:"GET",url:n.forum.attribute("apiUrl")+"/admin-email-export",deserialize:s=>s}),e=new Blob([t],{type:"text/plain;charset=utf-8"}),a=window.URL.createObjectURL(e),r=document.createElement("a"),d=new Date().toISOString().slice(0,10).replace(/-/g,"");r.href=a,r.download=`valid-emails-${d}.txt`,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(a);const p=t.trim().split(`
`).filter(s=>s.trim());this.exportCount=p.length,this.lastExportDate=new Date().toISOString(),localStorage.setItem("wusong8899_email_last_export",JSON.stringify({count:this.exportCount,date:this.lastExportDate})),n.alerts.show({type:"success"},`成功导出 ${this.exportCount} 个有效邮箱！`)}catch(t){console.error("Export failed:",t);let e="导出失败，请稍后重试";t.status===403?e="权限不足，只有管理员可以导出邮箱":t.status===500?e="服务器错误，请检查 PHP Intl 扩展是否已安装":t.status===204&&(e="没有找到有效的邮箱地址"),n.alerts.show({type:"error"},e)}finally{this.loading=!1,o.redraw()}}}formatDate(t){try{const e=new Date(t),a={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};return e.toLocaleString("zh-CN",a)}catch{return t}}}n.initializers.add("wusong8899-email",()=>{n.extensionData.for("wusong8899-email").registerSetting(function(){return o(u,null)})})})(flarum.core.compat["common/app"],flarum.core.compat["admin/app"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/Component"],m);
//# sourceMappingURL=admin.js.map

module.exports={};