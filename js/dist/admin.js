(function(s,a,i,l,o){"use strict";s.initializers.add("wusong8899-email-common",()=>{console.log("[wusong8899/flarum-email] Hello, forum and admin!")});class c extends l{constructor(){super(...arguments),this.loading=!1,this.exportCount=null,this.lastExportDate=null}oninit(){super.oninit();const t=localStorage.getItem("wusong8899_email_last_export");if(t)try{const e=JSON.parse(t);this.exportCount=e.count,this.lastExportDate=e.date}catch{}}view(){return o("div",{className:"Form-group"},o("label",null,"导出有效邮箱"),o("p",{className:"helpText"},"点击导出所有通过 RFC + DNS 检查的唯一邮箱，每行一个。",this.exportCount!==null&&this.lastExportDate&&o("span",{className:"helpText-success"},o("br",null),"上次导出: ",this.exportCount," 个邮箱 (",this.formatDate(this.lastExportDate),")")),o(i,{className:"Button Button--primary",type:"button",onclick:this.handleExport.bind(this),disabled:this.loading,loading:this.loading},this.loading?"导出中...":"导出邮箱"))}async handleExport(){if(!this.loading){this.loading=!0,o.redraw();try{const t=await a.request({method:"GET",url:a.forum.attribute("apiUrl")+"/admin-email-export",raw:!0}),e=new Blob([t],{type:"text/plain;charset=utf-8"}),r=window.URL.createObjectURL(e),n=document.createElement("a"),u=new Date().toISOString().slice(0,10).replace(/-/g,"");n.href=r,n.download=`valid-emails-${u}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(r);const d=t.trim().split(`
`).filter(p=>p.trim());this.exportCount=d.length,this.lastExportDate=new Date().toISOString(),localStorage.setItem("wusong8899_email_last_export",JSON.stringify({count:this.exportCount,date:this.lastExportDate})),a.alerts.show({type:"success"},`成功导出 ${this.exportCount} 个有效邮箱！`)}catch(t){console.error("Export failed:",t);let e="导出失败，请稍后重试";t.status===403?e="权限不足，只有管理员可以导出邮箱":t.status===500?e="服务器错误，请检查 PHP Intl 扩展是否已安装":t.status===204&&(e="没有找到有效的邮箱地址"),a.alerts.show({type:"error"},e)}finally{this.loading=!1,o.redraw()}}}formatDate(t){try{const e=new Date(t),r={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};return e.toLocaleString("zh-CN",r)}catch{return t}}}a.initializers.add("wusong8899-email",()=>{a.extensionData.for("wusong8899-email").registerSetting(function(){return o(c,null)})})})(flarum.core.compat["common/app"],flarum.core.compat["admin/app"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/Component"],m);
//# sourceMappingURL=admin.js.map

module.exports={};