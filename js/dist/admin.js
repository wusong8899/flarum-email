(function(l,r,c,u,o){"use strict";l.initializers.add("wusong8899-email-common",()=>{console.log("[wusong8899/flarum-email] Hello, forum and admin!")});class d extends u{constructor(){super(...arguments),this.loading=!1,this.exportCount=null,this.lastExportDate=null}oninit(e){super.oninit(e);const t=localStorage.getItem("wusong8899_email_last_export");if(t)try{const n=JSON.parse(t);this.exportCount=n.count,this.lastExportDate=n.date}catch{}}view(){return o("div",{className:"Form-group"},o("label",null,"导出有效邮箱"),o("p",{className:"helpText"},"点击导出所有通过 RFC + DNS 检查的唯一邮箱，每行一个。",this.exportCount!==null&&this.lastExportDate&&o("span",{className:"helpText-success"},o("br",null),"上次导出: ",this.exportCount," 个邮箱 (",this.formatDate(this.lastExportDate),")")),o(c,{className:"Button Button--primary",type:"button",onclick:()=>this.handleExport(),disabled:this.loading,loading:this.loading},this.loading?"导出中...":"导出邮箱"))}async handleExport(){if(console.log("Export button clicked"),!this.loading){this.loading=!0,o.redraw();try{console.log("Making request to:",r.forum.attribute("apiUrl")+"/admin-email-export");const e=await o.request({method:"GET",url:r.forum.attribute("apiUrl")+"/admin-email-export",extract:a=>a.responseText??"",deserialize:a=>a}),t=typeof e=="string"?e:String(e??"");if(t.trim().length===0){r.alerts.show({type:"warning"},"没有找到有效的邮箱地址");return}const n=new Blob([t],{type:"text/plain;charset=utf-8"}),i=window.URL.createObjectURL(n),s=document.createElement("a"),p=new Date().toISOString().slice(0,10).replace(/-/g,"");s.href=i,s.download=`valid-emails-${p}.txt`,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(i);const h=t.replace(/\r\n/g,`
`).trim().split(`
`).map(a=>a.trim()).filter(a=>a&&/@/.test(a)&&/[^\s@]+@[^\s@]+\.[^\s@]+/.test(a));this.exportCount=h.length,this.lastExportDate=new Date().toISOString(),localStorage.setItem("wusong8899_email_last_export",JSON.stringify({count:this.exportCount,date:this.lastExportDate})),r.alerts.show({type:"success"},`成功导出 ${this.exportCount} 个有效邮箱！`)}catch(e){console.error("Export failed:",e);let t="导出失败，请稍后重试";e.status===403?t="权限不足，只有管理员可以导出邮箱":e.status===500?t="服务器错误，请检查 PHP Intl 扩展是否已安装":e.status===204&&(t="没有找到有效的邮箱地址"),r.alerts.show({type:"error"},t)}finally{this.loading=!1,o.redraw()}}}formatDate(e){try{const t=new Date(e),n={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};return t.toLocaleString("zh-CN",n)}catch{return e}}}r.initializers.add("wusong8899-email",()=>{r.extensionData.for("wusong8899-email").registerSetting(function(){return o(d,null)})})})(flarum.core.compat["common/app"],flarum.core.compat["admin/app"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/Component"],m);
//# sourceMappingURL=admin.js.map

module.exports={};